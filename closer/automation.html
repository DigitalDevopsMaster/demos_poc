









<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <!-- Include Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- Main container with sidebar and content area -->
<div id="dashboardContainer" style="display:flex; font-family:'Segoe UI', Arial, sans-serif; color:#333; height:100vh; overflow:hidden; text-align:left;">
  
  <!-- Sidebar navigation -->
  <div id="sidebarCtn" style="width:240px; background:#f8f9fa; height:100%; border-right:1px solid #e9ecef; overflow-y:auto;">
    <!-- Logo and brand -->
    <div style="padding:20px; text-align:center;">
      <h2 style="margin:0; color:#5a67d8;">Closer Digital</h2>
      <p style="margin:5px 0 0; font-size:12px; color:#718096;">CRM Conversacional</p>
    </div>
    
    <!-- Navigation links -->
    <nav>
      <ul style="list-style:none; padding:0; margin:0;">
        <li class="nav-item" data-page="dashboard" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-home" style="margin-right:10px;"></i> Dashboard
        </li>
        <li class="nav-item" data-page="crm" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-user-friends" style="margin-right:10px;"></i> CRM Visual
        </li>
        <li class="nav-item" data-page="automation" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer; background:#e9ecef;">
          <i class="fas fa-robot" style="margin-right:10px;"></i> Automatizaciones
        </li>
        <li class="nav-item" data-page="inbox" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-inbox" style="margin-right:10px;"></i> Inbox Multicanal
        </li><!-- 
        <li class="nav-item" data-page="reports" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-chart-bar" style="margin-right:10px;"></i> Reportes
        </li>
        <li class="nav-item" data-page="appointments" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-calendar-alt" style="margin-right:10px;"></i> Citas
        </li>
        <li class="nav-item" data-page="campaigns" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-bullhorn" style="margin-right:10px;"></i> Campañas
        </li>
        <li class="nav-item" data-page="settings" style="padding:12px 20px; margin:4px 8px; border-radius:6px; cursor:pointer;">
          <i class="fas fa-cog" style="margin-right:10px;"></i> Configuración
        </li> -->
      </ul>
    </nav>
  </div>
  
  <!-- Main content area -->
  <div id="mainContentCtn" style="flex:1; height:100%; overflow-y:auto; background:#f5f7fa; padding:20px;">
    
    <!-- CRM Visual Page Content -->
    <div id="crmPage" class="content-page">
    </div>
    
    <!-- Automation Page Content -->
    <div id="automationPage" class="content-page">
      <!-- Flows List View - initially visible -->
      <div id="flowsListView">
        <h2>Automatizaciones</h2>
        <button id="newFlowBtn" style="padding:8px 16px; background:#5a67d8; color:white; border:none; border-radius:4px; cursor:pointer; margin-bottom:20px;">
          <i class="fas fa-plus" style="margin-right:8px;"></i> Nuevo
        </button>
        
        <div id="flowsList" style="border:1px solid #ddd; border-radius:5px; background:white;">
          <!-- Empty flow list - items will be added dynamically -->
        </div>
      </div>
      
      <!-- Flow Builder View - initially hidden -->
      <div id="flowBuilderView" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <div style="display:flex; align-items:center;">
            <h2 id="flowBuilderTitle" style="margin:0;">Nuevo Flujo</h2>
            <input id="flowNameInput" type="text" placeholder="Nombre del flujo" style="margin-left:15px; padding:8px; border:1px solid #ddd; border-radius:4px;">
          </div>
          <div style="display:flex; gap:10px;">
            <button id="saveFlowBtn" style="padding:6px 12px; background:#5a67d8; color:white; border:none; border-radius:4px; cursor:pointer;">
              <i class="fas fa-save" style="margin-right:5px;"></i> Guardar
            </button>
            <button id="backToListBtn" style="padding:6px 12px; background:#f0f0f0; border:1px solid #ddd; border-radius:4px; cursor:pointer;">
              <i class="fas fa-arrow-left" style="margin-right:5px;"></i> Volver
            </button>
          </div>
        </div>
        
        <!-- Config section -->
        <div style="padding:15px; background:white; border:1px solid #ddd; border-radius:5px;">
          <div style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px;">
            <!-- Channels section -->
            <div style="flex:1; min-width:200px;">
              <h4 style="margin-top:0;">Canales de activación</h4>
              <div style="display:flex; flex-direction:column; gap:8px;">
                <label style="display:flex; align-items:center;">
                  <input type="checkbox" id="whatsappChannel">
                  <span style="margin-left:5px;">WhatsApp</span>
                </label>
                <label style="display:flex; align-items:center;">
                  <input type="checkbox" id="instagramChannel">
                  <span style="margin-left:5px;">Instagram</span>
                </label>
                <label style="display:flex; align-items:center;">
                  <input type="checkbox" id="messengerChannel">
                  <span style="margin-left:5px;">Messenger</span>
                </label>
                <label style="display:flex; align-items:center;">
                  <input type="checkbox" id="webChannel">
                  <span style="margin-left:5px;">Web</span>
                </label>
                <label style="display:flex; align-items:center;">
                  <input type="checkbox" id="newsletterChannel">
                  <span style="margin-left:5px;">Suscripción a Newsletter</span>
                </label>
              </div>
            </div>
            
            <!-- Flow Activation section -->
            <div style="flex:1; min-width:200px;">
              <h4 style="margin-top:0;">Periodo de activación</h4>
              <div style="display:flex; flex-direction:column; gap:8px;">
                <label style="display:flex; align-items:center;">
                  <input type="radio" name="activationPeriod" id="alwaysActive" checked>
                  <span style="margin-left:5px;">Siempre activo</span>
                </label>
                <label style="display:flex; align-items:center;">
                  <input type="radio" name="activationPeriod" id="periodActive">
                  <span style="margin-left:5px;">Activo durante un periodo</span>
                </label>
                <div id="periodSelectionCtn" style="margin-left:20px; display:none;">
                  <div style="margin-bottom:8px;">
                    <label style="display:block; margin-bottom:5px;">Fecha de inicio:</label>
                    <input type="datetime-local" id="startDateInput" style="padding:6px; border:1px solid #ddd; border-radius:4px;">
                  </div>
                  <div>
                    <label style="display:block; margin-bottom:5px;">Fecha de fin:</label>
                    <input type="datetime-local" id="endDateInput" style="padding:6px; border:1px solid #ddd; border-radius:4px;">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Master Prompt section -->
          <div style="margin-top:20px;">
            <h4 style="margin-top:0;">Prompt Maestro</h4>
            <p style="margin-top:5px; font-size:0.9em; color:#666;">Define un prompt completo con todas las instrucciones necesarias para que la IA sepa exactamente qué hacer y cómo interactuar con tus usuarios.</p>
            
            <div style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px;">Objetivo principal:</label>
              <select id="objectiveTypeSelect" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; margin-bottom:10px;">
                <option value="">Selecciona un objetivo</option>
                <option value="sales">Venta de productos</option>
                <option value="support">Atención al cliente</option>
                <option value="lead">Generación de leads</option>
                <option value="info">Información / FAQ</option>
                <option value="appointment">Reserva de citas</option>
                <option value="feedback">Encuestas / Feedback</option>
              </select>
              
              <label style="display:block; margin-bottom:5px;">Prompt maestro:</label>
              <textarea id="masterPromptInput" placeholder="Escribe un prompt detallado con todas las instrucciones que el bot necesita para cumplir el objetivo..." style="width:100%; padding:12px; height:250px; border:1px solid #ddd; border-radius:4px; resize:vertical; font-family:inherit;"></textarea>
              <p style="margin-top:8px; font-size:0.9em; color:#666;">Incluye detalles sobre el tono, personalidad, información específica de productos/servicios, pasos a seguir, cómo manejar preguntas comunes, límites de lo que el bot puede hacer, etc.</p>
            </div>
            
            <!-- Prompt suggestions based on objective -->
            <div id="promptSuggestionsCtn" style="margin-top:15px; padding:12px; background:#f8f9fa; border:1px solid #ddd; border-radius:4px; display:none;">
              <h5 style="margin-top:0; margin-bottom:10px;">Sugerencias para tu prompt:</h5>
              <div id="promptSuggestions" style="font-size:0.9em;"></div>
              <button id="insertSuggestionBtn" style="margin-top:10px; padding:6px 12px; background:#5a67d8; color:white; border:none; border-radius:4px; cursor:pointer;">
                <i class="fas fa-plus" style="margin-right:5px;"></i> Insertar en prompt
              </button>
            </div>
            
            <!-- AI Test section -->
            <div style="margin-top:20px;">
              <h5 style="margin-bottom:10px;">Probar el prompt</h5>
              <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input id="testMessageInput" placeholder="Escribe un mensaje de prueba..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px;">
                <button id="testPromptBtn" style="padding:8px 16px; background:#5a67d8; color:white; border:none; border-radius:4px; cursor:pointer;">
                  <i class="fas fa-vial" style="margin-right:5px;"></i> Probar
                </button>
              </div>
              <div id="testResultCtn" style="display:none; padding:12px; border:1px solid #ddd; border-radius:4px; background:white; margin-top:10px;">
                <h6 style="margin-top:0; margin-bottom:8px;">Respuesta del bot:</h6>
                <div id="testResultContent" style="font-size:0.9em; white-space:pre-wrap;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const navItems = document.querySelectorAll('.nav-item');

  navItems.forEach(item => {
    item.addEventListener('click', function() {
      window.location.href = `${item.getAttribute(`data-page`)}.html`;
    });
  });

  // UI Management
  document.getElementById('newFlowBtn').addEventListener('click', function() {
    showFlowBuilder('Nuevo Flujo');
  });
  
  document.getElementById('backToListBtn').addEventListener('click', function() {
    hideFlowBuilder();
  });
  
  document.getElementById('saveFlowBtn').addEventListener('click', function() {
    saveFlow();
  });
  
  function showFlowBuilder(title, flowId) {
    document.getElementById('flowsListView').style.display = 'none';
    document.getElementById('flowBuilderView').style.display = 'block';
    document.getElementById('flowBuilderTitle').textContent = title;
    document.getElementById('flowNameInput').value = title.startsWith('Editar: ') ? title.substring(8) : '';
  }
  
  function hideFlowBuilder() {
    document.getElementById('flowBuilderView').style.display = 'none';
    document.getElementById('flowsListView').style.display = 'block';
  }
  
  function saveFlow() {
    const flowName = document.getElementById('flowNameInput').value.trim();
    if (!flowName) {
      alert('Por favor, ingresa un nombre para el flujo.');
      return;
    }
    
    // Get channel configuration
    const flowConfig = {
      channels: {
        whatsapp: document.getElementById('whatsappChannel').checked,
        instagram: document.getElementById('instagramChannel').checked,
        messenger: document.getElementById('messengerChannel').checked,
        web: document.getElementById('webChannel').checked,
        newsletter: document.getElementById('newsletterChannel').checked
      },
      activation: {
        always: document.getElementById('alwaysActive').checked,
        period: document.getElementById('periodActive').checked,
        startDate: document.getElementById('startDateInput').value,
        endDate: document.getElementById('endDateInput').value
      },
      objective: {
        type: document.getElementById('objectiveTypeSelect').value,
        masterPrompt: document.getElementById('masterPromptInput').value
      }
    };
    
    // Create flow data
    const flowData = {
      name: flowName,
      config: flowConfig
    };
    
    console.log('Saving flow:', flowData);
    
    // Here you would send the flow data to your backend
    // For now, just show a success message
    alert(`Flujo "${flowName}" guardado con éxito.`);
    
    hideFlowBuilder();
  }

  // Prompt suggestions based on objective type
  document.getElementById('objectiveTypeSelect').addEventListener('change', function() {
    const objectiveType = this.value;
    const suggestionsCtn = document.getElementById('promptSuggestionsCtn');
    const suggestionsContent = document.getElementById('promptSuggestions');
    
    if (!objectiveType) {
      suggestionsCtn.style.display = 'none';
      return;
    }
    
    let suggestions = '';
    switch(objectiveType) {
      case 'sales':
        suggestions = `
          <p>- Eres un asistente de ventas para [nombre de la empresa] especializado en ayudar a los clientes a encontrar el producto perfecto.</p>
          <p>- Tu objetivo es guiar al cliente hacia la compra de manera natural, respondiendo a sus preguntas y ofreciendo alternativas cuando sea necesario.</p>
          <p>- Los productos disponibles son: [lista de productos con sus características y precios]</p>
          <p>- Si el cliente muestra interés en un producto específico, pregunta si desea proceder con la compra.</p>
          <p>- Si el cliente solicita información que no tienes, ofrece conectarlo con un representante humano.</p>
        `;
        break;
      case 'support':
        suggestions = `
          <p>- Eres un asistente de soporte técnico para [nombre de la empresa] especializado en resolver problemas de los clientes.</p>
          <p>- Primero intenta entender exactamente cuál es el problema del cliente haciendo preguntas específicas.</p>
          <p>- Las categorías comunes de problemas incluyen: [lista de categorías]</p>
          <p>- Para problemas técnicos comunes, sigue estos pasos de solución: [pasos de troubleshooting]</p>
          <p>- Si no puedes resolver el problema después de intentar las soluciones estándar, ofrece escalar el caso a un técnico especializado.</p>
        `;
        break;
      case 'lead':
        suggestions = `
          <p>- Eres un asistente virtual de [nombre de la empresa] cuyo objetivo es calificar leads potenciales.</p>
          <p>- Debes recopilar la siguiente información: nombre, correo electrónico, teléfono, empresa, presupuesto estimado y timeline del proyecto.</p>
          <p>- Haz las preguntas de manera conversacional, no todas a la vez.</p>
          <p>- Explica brevemente los servicios/productos que ofrece la empresa: [descripción de servicios]</p>
          <p>- Al finalizar la recopilación de datos, agradece al usuario y explica que un representante se pondrá en contacto pronto.</p>
        `;
        break;
      case 'info':
        suggestions = `
          <p>- Eres un asistente informativo de [nombre de la empresa] especializado en responder preguntas sobre nuestros productos y servicios.</p>
          <p>- La información que puedes proporcionar incluye: horarios de atención, ubicaciones, servicios disponibles, precios, y políticas de la empresa.</p>
          <p>- Datos específicos importantes: [lista de datos clave como horarios, direcciones, etc.]</p>
          <p>- Si te preguntan sobre algo que no está en tu base de conocimientos, ofrece tomar sus datos para que un representante pueda contactarlos con la información.</p>
        `;
        break;
      case 'appointment':
        suggestions = `
          <p>- Eres un asistente de reservas para [nombre de la empresa] encargado de ayudar a los clientes a programar citas.</p>
          <p>- Los tipos de servicios disponibles para reservar son: [lista de servicios]</p>
          <p>- Horarios disponibles: [detalle de horarios]</p>
          <p>- Solicita la siguiente información para completar la reserva: nombre completo, teléfono, tipo de servicio, fecha y hora preferida.</p>
          <p>- Una vez confirmada la cita, proporciona un resumen de la reserva y explica la política de cancelación.</p>
        `;
        break;
      case 'feedback':
        suggestions = `
          <p>- Eres un asistente de [nombre de la empresa] encargado de recopilar feedback de los clientes sobre nuestros productos/servicios.</p>
          <p>- Haz preguntas específicas sobre: calidad del producto/servicio, atención al cliente, facilidad de uso, y sugerencias de mejora.</p>
          <p>- Mantén un tono conversacional y amigable, agradeciendo siempre por los comentarios recibidos.</p>
          <p>- Si el cliente menciona algún problema, muestra empatía y pregunta por más detalles para entender mejor la situación.</p>
          <p>- Al finalizar, agradece al cliente por su tiempo y explica cómo su feedback ayudará a mejorar.</p>
        `;
        break;
    }
    
    suggestionsContent.innerHTML = suggestions;
    suggestionsCtn.style.display = 'block';
  });
  
  // Insert suggestion into master prompt
  document.getElementById('insertSuggestionBtn').addEventListener('click', function() {
    const masterPromptInput = document.getElementById('masterPromptInput');
    const suggestions = document.getElementById('promptSuggestions').innerText;
    
    // Insert at cursor position or append to end
    if (masterPromptInput.selectionStart || masterPromptInput.selectionStart === 0) {
      const startPos = masterPromptInput.selectionStart;
      const endPos = masterPromptInput.selectionEnd;
      
      masterPromptInput.value = masterPromptInput.value.substring(0, startPos) + 
                              suggestions + 
                              masterPromptInput.value.substring(endPos, masterPromptInput.value.length);
      
      masterPromptInput.focus();
      masterPromptInput.selectionStart = startPos + suggestions.length;
      masterPromptInput.selectionEnd = startPos + suggestions.length;
    } else {
      masterPromptInput.value += suggestions;
    }
  });
  
  // Test prompt functionality
  document.getElementById('testPromptBtn').addEventListener('click', async function() {
    const testMessage = document.getElementById('testMessageInput').value.trim();
    const masterPrompt = document.getElementById('masterPromptInput').value.trim();
    const objectiveType = document.getElementById('objectiveTypeSelect').value;
    
    if (!testMessage) {
      alert('Por favor, escribe un mensaje de prueba.');
      return;
    }
    
    if (!masterPrompt) {
      alert('Por favor, escribe un prompt maestro para probar.');
      return;
    }
    
    // Show loading state
    const testBtn = document.getElementById('testPromptBtn');
    const originalBtnText = testBtn.innerHTML;
    testBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
    testBtn.disabled = true;
    
    // Here you would normally call your AI service with the prompt and test message
    // For this example, we'll simulate a response after a delay
    setTimeout(() => {
      const resultCtn = document.getElementById('testResultCtn');
      const resultContent = document.getElementById('testResultContent');
      
      // Generate a mock response based on the objective type
      let response = '';
      switch(objectiveType) {
        case 'sales':
          response = `¡Hola! Gracias por tu interés en nuestros productos. ${testMessage.includes('precio') ? 'El precio de ese producto es $99.99. ¿Te gustaría proceder con la compra?' : '¿Puedo ayudarte a encontrar algún producto específico hoy?'}`;
          break;
        case 'support':
          response = `Entiendo que estás experimentando un problema. ${testMessage.includes('error') ? 'Para solucionar ese error, primero intenta reiniciar el dispositivo. Si el problema persiste, podemos revisar más a fondo.' : '¿Podrías darme más detalles sobre el problema que estás teniendo?'}`;
          break;
        case 'lead':
          response = `Gracias por tu interés en nuestros servicios. ${testMessage.includes('nombre') ? 'He registrado tu nombre. ¿Podrías también compartir tu correo electrónico para que podamos enviarte información adicional?' : '¿Podrías compartir tu nombre para comenzar?'}`;
          break;
        case 'info':
          response = `${testMessage.includes('horario') ? 'Nuestro horario de atención es de lunes a viernes de 9:00 a 18:00 y sábados de 10:00 a 14:00.' : '¿Qué información específica estás buscando sobre nuestra empresa?'}`;
          break;
        case 'appointment':
          response = `${testMessage.includes('cita') ? 'Para agendar una cita, necesitaría saber qué día y hora te gustaría reservar. Tenemos disponibilidad los martes y jueves por la tarde.' : '¿Te gustaría agendar una cita con nosotros?'}`;
          break;
        case 'feedback':
          response = `Agradecemos mucho tu feedback. ${testMessage.includes('mejorar') ? 'Tus sugerencias son muy valiosas para mejorar nuestro servicio. ¿Hay algo específico que crees que podríamos hacer mejor?' : '¿Cómo calificarías tu experiencia con nuestro producto/servicio?'}`;
          break;
        default:
          response = `Gracias por tu mensaje: "${testMessage}". Como asistente virtual, estoy aquí para ayudarte con cualquier pregunta o solicitud que tengas.`;
      }
      
      resultContent.textContent = response;
      resultCtn.style.display = 'block';
      
      // Reset button state
      testBtn.innerHTML = originalBtnText;
      testBtn.disabled = false;
    }, 1500);
  });
  
  // Setup activation period toggle
  document.getElementById('alwaysActive').addEventListener('change', function() {
    document.getElementById('periodSelectionCtn').style.display = 'none';
  });
  
  document.getElementById('periodActive').addEventListener('change', function() {
    document.getElementById('periodSelectionCtn').style.display = 'block';
  });
</script>

</body>
</html>
